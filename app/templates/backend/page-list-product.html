<!-- SOSTITUISCI il contenuto del file app/templates/backend/page-list-product.html -->

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Lista Prodotti | Net4U Inventory</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="../../static/images/favicon.ico" />
    <link rel="stylesheet" href="../../static/css/backend-plugin.min.css">
    <link rel="stylesheet" href="../../static/css/backend.css?v=1.0.0">
    <link rel="stylesheet" href="../../static/vendor/@fortawesome/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="../../static/vendor/line-awesome/dist/line-awesome/css/line-awesome.min.css">
    <link rel="stylesheet" href="../../static/vendor/remixicon/fonts/remixicon.css">
</head>

<body class="color-light">
    <!-- loader Start -->
    <div id="loading">
        <div id="loading-center"></div>
    </div>
    <!-- loader END -->

    <!-- Wrapper Start -->
    <div class="wrapper">
        {% include "./backend/sidebar.html" %}
        {% include "./backend/navbar.html" %}
        <div class="content-page">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div class="header-title">
                                    <h4 class="card-title">Lista Prodotti</h4>
                                    <p class="mb-0">Gestisci tutti i prodotti del sistema</p>
                                </div>
                                <div>
                                    <a href="{{ url_for('main.add_product') }}" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> Aggiungi Prodotto
                                    </a>
                                    <a href="{{ url_for('main.add_multiple_products') }}" class="btn btn-success ml-2">
                                        <i class="fas fa-plus-circle"></i> Multipli
                                    </a>
                                </div>
                            </div>

                            <div class="card-body">
                                <!-- Messaggi flash -->
                                {% if messages %}
                                {% for category, message in messages %}
                                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
                                    role="alert">
                                    {{ message }}
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                {% endfor %}
                                {% endif %}

                                <!-- Filtri e ricerca -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="search-products"
                                                placeholder="Cerca prodotti...">
                                            <div class="input-group-append">
                                                <span class="input-group-text">
                                                    <i class="fas fa-search"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex">
                                            <select class="form-control mr-2" id="filter-project">
                                                <option value="">Tutti i progetti</option>
                                                {% for product in products %}
                                                <option value="{{ product.project.name }}">{{ product.project.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                            <button class="btn btn-outline-secondary" onclick="clearFilters()">
                                                <i class="fas fa-times"></i> Pulisci
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Lista prodotti -->
                                {% if products %}
                                <div class="row" id="products-grid">
                                    {% for product in products %}
                                    <div class="col-lg-6 col-xl-4 mb-4 product-item"
                                        data-name="{{ product.name|lower }}" data-code="{{ product.unique_code|lower }}"
                                        data-project="{{ product.project.name|lower }}">
                                        <div
                                            class="card product-card h-100 {% if not product.is_active %}bg-light{% endif %}">

                                            <!-- SEZIONE IMMAGINE - NUOVA -->
                                            <div class="product-image-container">
                                                {% if product.image_path %}
                                                <img src="{{ product.image_path }}" class="card-img-top product-image"
                                                    alt="{{ product.name }}"
                                                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                <div class="image-placeholder" style="display: none;">
                                                    <i class="fas fa-image fa-3x text-muted"></i>
                                                    <p class="text-muted mt-2">Immagine non disponibile</p>
                                                </div>
                                                {% else %}
                                                <div class="image-placeholder">
                                                    <i class="fas fa-image fa-3x text-muted"></i>
                                                    <p class="text-muted mt-2">Nessuna immagine</p>
                                                </div>
                                                {% endif %}

                                                <!-- Badge stato -->
                                                {% if not product.is_active %}
                                                <div class="status-badge badge-disabled">
                                                    <i class="fas fa-eye-slash"></i> Nascosto
                                                </div>
                                                {% endif %}

                                                <!-- Badge quantità -->
                                                <div class="quantity-badge">
                                                    <i class="fas fa-cubes"></i> {{ product.quantity }}
                                                </div>
                                            </div>

                                            <div class="card-body d-flex flex-column">
                                                <!-- Header prodotto -->
                                                <div class="product-header mb-3">
                                                    <h5 class="card-title mb-1">
                                                        <i class="fas fa-box text-primary"></i>
                                                        {{ product.name }}
                                                    </h5>
                                                    <p class="card-subtitle text-muted">
                                                        <i class="fas fa-barcode"></i> {{ product.unique_code }}
                                                    </p>
                                                </div>

                                                <!-- Descrizione -->
                                                {% if product.description %}
                                                <p class="card-text text-muted mb-3">
                                                    {{ product.description[:80] }}{% if product.description|length > 80
                                                    %}...{% endif %}
                                                </p>
                                                {% endif %}

                                                <!-- Informazioni prodotto -->
                                                <div class="product-info mb-3">
                                                    <div class="info-item">
                                                        <i class="fas fa-building text-info"></i>
                                                        <span class="font-weight-bold">Posizione:</span>
                                                        {{ product.location.pavilion }}
                                                        {% if product.location.room %}, {{ product.location.room }}{%
                                                        endif %}
                                                        {% if product.location.cabinet %}, {{ product.location.cabinet
                                                        }}{% endif %}
                                                    </div>

                                                    <div class="info-item">
                                                        <i class="fas fa-project-diagram text-success"></i>
                                                        <span class="font-weight-bold">Progetto:</span>
                                                        {{ product.project.name }}
                                                    </div>

                                                    <div class="info-item">
                                                        <i class="fas fa-user text-warning"></i>
                                                        <span class="font-weight-bold">Proprietario:</span>
                                                        {% for user in [product.owner_id] %}
                                                        {{ user.name }} {{ user.surname }}
                                                        {% endfor %}
                                                    </div>
                                                </div>

                                                <!-- Categorie -->
                                                {% if product.categories %}
                                                <div class="categories mb-3">
                                                    {% for category in product.categories %}
                                                    <span class="badge badge-secondary mr-1">{{ category.name }}</span>
                                                    {% endfor %}
                                                </div>
                                                {% endif %}

                                                <!-- Manager -->
                                                {% if product.managers %}
                                                <div class="managers mb-3">
                                                    <small class="text-muted">
                                                        <i class="fas fa-users"></i> Manager:
                                                        {% for manager in product.managers[:2] %}
                                                        {{ manager.name }} {{ manager.surname }}{% if not loop.last %},
                                                        {% endif %}
                                                        {% endfor %}
                                                        {% if product.managers|length > 2 %}
                                                        e altri {{ product.managers|length - 2 }}
                                                        {% endif %}
                                                    </small>
                                                </div>
                                                {% endif %}

                                                <!-- Azioni -->
                                                <div class="card-actions mt-auto">
                                                    <div class="btn-group w-100" role="group">
                                                        <a href="{{ url_for('main.view_product', encrypted_id=auth_s.dumps(product.id)) }}"
                                                            class="btn btn-outline-primary btn-sm">
                                                            <i class="fas fa-eye"></i> Visualizza
                                                        </a>

                                                        {% if product.owner_id == current_user.id or current_user in
                                                        product.managers %}
                                                        <a href="{{ url_for('main.view_product', encrypted_id=auth_s.dumps(product.id)) }}#edit"
                                                            class="btn btn-outline-secondary btn-sm">
                                                            <i class="fas fa-edit"></i> Modifica
                                                        </a>

                                                        <a href="{{ url_for('main.toggle_product', product_id=product.id) }}"
                                                            class="btn btn-outline-warning btn-sm"
                                                            onclick="return confirm('Sicuro di voler {{ 'nascondere' if product.is_active else 'mostrare' }} questo prodotto?')">
                                                            <i
                                                                class="fas fa-{% if product.is_active %}eye-slash{% else %}eye{% endif %}"></i>
                                                        </a>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- Paginazione se necessaria -->
                                <div class="d-flex justify-content-center mt-4">
                                    <p class="text-muted">Mostrati {{ products|length }} prodotti</p>
                                </div>

                                {% else %}
                                <!-- Nessun prodotto -->
                                <div class="text-center py-5">
                                    <i class="fas fa-box-open fa-5x text-muted mb-4"></i>
                                    <h4 class="text-muted">Nessun prodotto trovato</h4>
                                    <p class="text-muted">Non ci sono prodotti nel sistema o corrispondenti ai filtri
                                        selezionati.</p>
                                    <a href="{{ url_for('main.add_product') }}" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> Aggiungi il primo prodotto
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CSS per le immagini e il layout -->
        <style>
            /* Stili per le immagini dei prodotti */
            .product-image-container {
                position: relative;
                height: 200px;
                overflow: hidden;
                background-color: #f8f9fa;
            }

            .product-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.3s ease;
            }

            .product-image:hover {
                transform: scale(1.05);
            }

            .image-placeholder {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                background-color: #f8f9fa;
                border-bottom: 1px solid #dee2e6;
            }

            .image-placeholder p {
                font-size: 0.875rem;
                margin: 0;
            }

            /* Badge per status e quantità */
            .status-badge {
                position: absolute;
                top: 10px;
                left: 10px;
                background-color: rgba(220, 53, 69, 0.9);
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.75rem;
                font-weight: 600;
            }

            .quantity-badge {
                position: absolute;
                top: 10px;
                right: 10px;
                background-color: rgba(0, 123, 255, 0.9);
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.75rem;
                font-weight: 600;
            }

            .badge-disabled {
                background-color: rgba(108, 117, 125, 0.9) !important;
            }

            /* Stili per le card prodotti */
            .product-card {
                transition: all 0.3s ease;
                border: 1px solid #dee2e6;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .product-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                border-color: #007bff;
            }

            .product-card.bg-light {
                opacity: 0.7;
            }

            .product-header .card-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: #2c3e50;
            }

            .product-header .card-subtitle {
                font-size: 0.9rem;
            }

            /* Informazioni prodotto */
            .info-item {
                display: flex;
                align-items: center;
                margin-bottom: 0.5rem;
                font-size: 0.875rem;
            }

            .info-item i {
                width: 20px;
                margin-right: 8px;
            }

            /* Categorie */
            .categories .badge {
                font-size: 0.75rem;
            }

            /* Manager */
            .managers {
                font-size: 0.875rem;
            }

            /* Azioni */
            .card-actions .btn {
                font-size: 0.8rem;
                padding: 0.375rem 0.5rem;
            }

            /* Layout responsivo */
            @media (max-width: 768px) {
                .product-image-container {
                    height: 150px;
                }

                .col-lg-6 {
                    margin-bottom: 1rem;
                }
            }

            @media (max-width: 576px) {
                .product-image-container {
                    height: 120px;
                }

                .card-actions .btn-group {
                    flex-direction: column;
                }

                .card-actions .btn {
                    margin-bottom: 0.25rem;
                    border-radius: 0.375rem !important;
                }
            }

            /* Animazioni */
            .product-item {
                opacity: 0;
                animation: fadeInUp 0.6s ease forwards;
            }

            .product-item:nth-child(1) {
                animation-delay: 0.1s;
            }

            .product-item:nth-child(2) {
                animation-delay: 0.2s;
            }

            .product-item:nth-child(3) {
                animation-delay: 0.3s;
            }

            .product-item:nth-child(4) {
                animation-delay: 0.4s;
            }

            .product-item:nth-child(5) {
                animation-delay: 0.5s;
            }

            .product-item:nth-child(6) {
                animation-delay: 0.6s;
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        </style>

        <!-- JavaScript per filtri e ricerca -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const searchInput = document.getElementById('search-products');
                const projectFilter = document.getElementById('filter-project');
                const productItems = document.querySelectorAll('.product-item');

                // Funzione di ricerca
                function filterProducts() {
                    const searchTerm = searchInput.value.toLowerCase();
                    const selectedProject = projectFilter.value.toLowerCase();

                    productItems.forEach(item => {
                        const name = item.dataset.name;
                        const code = item.dataset.code;
                        const project = item.dataset.project;

                        const matchesSearch = name.includes(searchTerm) || code.includes(searchTerm);
                        const matchesProject = !selectedProject || project.includes(selectedProject);

                        if (matchesSearch && matchesProject) {
                            item.style.display = 'block';
                            item.style.animation = 'fadeInUp 0.4s ease forwards';
                        } else {
                            item.style.display = 'none';
                        }
                    });

                    // Aggiorna contatore
                    const visibleItems = document.querySelectorAll('.product-item[style*="block"]').length;
                    const counter = document.querySelector('.text-muted');
                    if (counter) {
                        counter.textContent = `Mostrati ${visibleItems} prodotti`;
                    }
                }

                // Event listeners
                searchInput.addEventListener('input', filterProducts);
                projectFilter.addEventListener('change', filterProducts);

                // Rimuovi duplicati dal select progetti
                const projectOptions = Array.from(projectFilter.options);
                const uniqueProjects = [];
                projectOptions.forEach(option => {
                    if (option.value && !uniqueProjects.includes(option.value)) {
                        uniqueProjects.push(option.value);
                    } else if (option.value && uniqueProjects.includes(option.value)) {
                        option.remove();
                    }
                });
            });

            function clearFilters() {
                document.getElementById('search-products').value = '';
                document.getElementById('filter-project').value = '';

                // Mostra tutti i prodotti
                document.querySelectorAll('.product-item').forEach(item => {
                    item.style.display = 'block';
                });

                // Reset contatore
                const counter = document.querySelector('.text-muted');
                if (counter) {
                    const totalItems = document.querySelectorAll('.product-item').length;
                    counter.textContent = `Mostrati ${totalItems} prodotti`;
                }
            }
        </script>

        <!-- Backend Bundle JavaScript -->
        <script src="../../static/js/backend-bundle.min.js"></script>

        <!-- Table Treeview JavaScript -->
        <script src="../../static/js/table-treeview.js"></script>

        <!-- Chart Custom JavaScript -->
        <script src="../../static/js/customizer.js"></script>

        <!-- Chart Custom JavaScript -->
        <script async src="../../static/js/chart-custom.js"></script>

        <!-- app JavaScript -->
        <script src="../../static/js/app.js"></script>

</body>

</html>